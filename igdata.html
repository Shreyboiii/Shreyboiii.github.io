<!DOCTYPE html>
<html>
<head>
    <title>Instagram Code</title>
</head>
<body>
    <h1>Instagram Code</h1>
    <div id="code"></div>
    <div id="shortLivedToken"></div>
    <div id="token"></div>
    <div id="expiry"></div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const code = urlParams.get('code');
        const clientId = "1153807892876290";
        const clientSecret = "9b84f2f7aa39bd5e6618ab014fd13365";
        const redirectUri = "https://shreyboiii.github.io/igdata";

        if (code) {
            document.getElementById('code').innerText = "Code: " + code;

            fetch('https://api.instagram.com/oauth/access_token', {
                method: 'POST',
                body: new URLSearchParams({
                    client_id: clientId,
                    client_secret: clientSecret,
                    code: code,
                    grant_type: 'authorization_code',
                    redirect_uri: redirectUri
                })
            }).then(response => response.json())
                .then(data => {
                    if (data.access_token) {
                        const shortLivedToken = data.access_token;
                        document.getElementById('shortLivedToken').innerText = "Short Lived Token: " + shortLivedToken;

                        fetch('https://graph.instagram.com/access_token?grant_type=ig_exchange_token&client_secret=' + clientSecret + '&access_token=' + shortLivedToken, {
                            method: 'GET',
                        }).then(response => response.json())
                            .then(data => {
                                if (data.access_token) {
                                    document.getElementById('token').innerText = "Long Lived Token: " + data.access_token;
                                    document.getElementById('expiry').innerText = "Expires in: " + data.expires_in + " seconds";
                                } else {
                                    document.getElementById('token').innerText = "Error getting long-lived token: " + JSON.stringify(data);
                                }
                            });
                    } else {
                        document.getElementById('code').innerText = "Error getting short-lived token: " + JSON.stringify(data);
                    }
                });

        } else {
            document.getElementById('code').innerText = 'No code found.';
        }
    </script>
</body>
</html>